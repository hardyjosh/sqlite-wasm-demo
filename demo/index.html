<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SQLite Demo</title>
</head>
<body>
    <div id="results"></div>
    <div>Tab ID: <span id="tab-id"></span></div>
    <button id="check-leader">Check Leader Status</button>
    <button id="execute-query">Execute Query (Leader Only)</button>

    <script type="module">
        import init, { BrowserSQLite } from './pkg/browser_sqlite.js';

        async function run() {
            await init();
            const db = new BrowserSQLite();
            
            // Display tab ID
            document.getElementById('tab-id').textContent = db.get_tab_id();
            
            // Add leader check button handler
            document.getElementById('check-leader').onclick = async () => {
                const isLeader = await db.check_leader();
                alert(`This tab ${isLeader ? 'is' : 'is not'} the leader`);
            };

            // Add direct query button handler
            document.getElementById('execute-query').onclick = async () => {
                try {
                    const results = await db.query("SELECT * FROM users");
                    console.log("Query executed successfully");
                    console.log(results);
                } catch (e) {
                    console.error("Query failed:", e);
                }
            };

            console.log("Created BrowserSQLite instance:", db);

            // wait for 1 second
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            try {
                console.log("Creating table...");
                try {
                    await db.execute("CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT)");
                } catch (e) {
                    console.error("Error creating table:", e);
                }
                
                try {
                    console.log("Inserting data...");
                    await db.execute("INSERT INTO users (name) VALUES ('Alice'), ('Bob')");
                } catch (e) {
                    console.error("Error inserting data:", e);
                }
                try {
                    console.log("Querying data...");
                    const results = await db.query("SELECT * FROM users");
                    
                    console.log("Results:", results);
                    document.getElementById('results').textContent = 
                        JSON.stringify(results, null, 2);

                } catch (e) {
                    console.error("Error querying data:", e);
                }
            } catch (e) {
                console.error("Database error:", e);
                document.getElementById('results').textContent = 
                    "Error: " + e.message;
            }
        }
        
        run().catch(console.error);
    </script>

    hi
</body>
</html> 